<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Puzzle Racer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        #timer {
            color: #e74c3c;
        }
        
        #score {
            color: #27ae60;
        }
        
        #board {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        #controls {
            margin: 25px 0;
        }
        
        #startBtn {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #startBtn:hover {
            background: #2980b9;
        }
        
        #startBtn:active {
            transform: translateY(2px);
        }
        
        .instructions {
            color: #666;
            margin-top: 20px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .game-info {
                font-size: 1.2em;
            }
            
            #startBtn {
                padding: 12px 30px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>‚ôû Chess Puzzle Racer</h1>
        
        <div class="game-info">
            <div id="timer">‚è∞ Time: 60s</div>
            <div id="score">üèÜ Score: 0</div>
        </div>
        
        <div id="board"></div>
        
        <div id="controls">
            <button id="startBtn">üéÆ Start Game</button>
        </div>
        
        <div class="instructions">
            <p><strong>How to play:</strong> Solve chess puzzles before time runs out! Each correct move gives +10 points.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    
    <script>
    class PuzzleRacer {
        constructor() {
            this.board = null;
            this.game = null;
            this.timeLeft = 60;
            this.score = 0;
            this.timer = null;
            this.currentPuzzle = null;
            this.isGameRunning = false;
            
            this.init();
        }

        init() {
            this.game = new Chess();
            this.board = Chessboard('board', {
                position: 'start',
                draggable: true,
                onDrop: this.handleMove.bind(this),
                pieceTheme: 'https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/img/chesspieces/wikipedia/{piece}.png'
            });

            document.getElementById('startBtn').addEventListener('click', () => {
                this.startGame();
            });
        }

        async startGame() {
            if (this.isGameRunning) return;
            
            this.isGameRunning = true;
            this.timeLeft = 60;
            this.score = 0;
            this.updateDisplay();
            
            document.getElementById('startBtn').textContent = 'Game Running...';
            document.getElementById('startBtn').disabled = true;
            
            // Clear existing timer
            if (this.timer) {
                clearInterval(this.timer);
            }
            
            // Start countdown
            this.timer = setInterval(() => {
                this.timeLeft--;
                this.updateDisplay();
                
                if (this.timeLeft <= 0) {
                    this.endGame();
                }
            }, 1000);

            await this.loadNewPuzzle();
        }

        async loadNewPuzzle() {
            try {
                // Try to get a puzzle from Lichess API
                const response = await fetch('https://lichess.org/api/puzzle/daily');
                const puzzle = await response.json();
                this.currentPuzzle = puzzle;
                
                this.game.load(puzzle.fen);
                this.board.position(puzzle.fen);
                
            } catch (error) {
                console.log('Using local puzzle');
                this.loadLocalPuzzle();
            }
        }

        loadLocalPuzzle() {
            // Local fallback puzzles
            const puzzles = [
                {
                    fen: 'r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 1',
                    solution: ['f3g5']
                },
                {
                    fen: 'rnbqkbnr/pppp1ppp/8/4p3/6P1/5P2/PPPPP2P/RNBQKBNR b KQkq - 0 1',
                    solution: ['d8h4']
                },
                {
                    fen: 'rnbqkbnr/ppp2ppp/3p4/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 1',
                    solution: ['f3e5']
                }
            ];
            
            this.currentPuzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
            this.game.load(this.currentPuzzle.fen);
            this.board.position(this.currentPuzzle.fen);
        }

        handleMove(source, target) {
            if (!this.isGameRunning) return 'snapback';
            
            const move = this.game.move({
                from: source,
                to: target,
                promotion: 'q'
            });

            // Illegal move
            if (move === null) return 'snapback';

            // Check if correct move
            if (this.isCorrectMove(move)) {
                this.score += 10;
                this.updateDisplay();
                setTimeout(() => this.loadNewPuzzle(), 500);
            }
        }

        isCorrectMove(move) {
            const moveStr = move.from + move.to;
            return this.currentPuzzle.solution.includes(moveStr);
        }

        updateDisplay() {
            document.getElementById('timer').textContent = `‚è∞ Time: ${this.timeLeft}s`;
            document.getElementById('score').textContent = `üèÜ Score: ${this.score}`;
        }

        endGame() {
            this.isGameRunning = false;
            clearInterval(this.timer);
            
            document.getElementById('startBtn').textContent = 'üéÆ Play Again';
            document.getElementById('startBtn').disabled = false;
            
            alert(`üéØ Game Over!\n\nYour final score: ${this.score}\n\nClick "Play Again" to restart!`);
            
            // Reset board
            this.game = new Chess();
            this.board.position('start');
        }
    }

    // Initialize the game when page loads
    document.addEventListener('DOMContentLoaded', () => {
        new PuzzleRacer();
    });
    </script>
</body>
</html>
